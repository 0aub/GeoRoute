# GeoRoute Centralized Configuration
# All settings are managed from this single file

# Route Generation Method
route_generation:
  # Method: "gemini_image" - Gemini 3 Pro Image draws routes directly on satellite imagery
  method: "gemini_image"
  # Number of routes to generate (2 = better quality, 3 = more options)
  num_routes: 2

# Gemini AI Models
gemini:
  # Image model for drawing routes on satellite images
  # - gemini-2.5-flash-image: GA on Vertex AI (recommended)
  # - gemini-3-pro-image-preview: requires preview access
  image_model: "gemini-2.5-flash-image"
  text_model: "gemini-2.5-flash"             # For basic text generation
  analysis_model: "gemini-2.5-flash"         # For tactical analysis with vision

# Route Generation Prompt
route_prompt: |
  Edit this satellite image. Draw exactly 2 infantry foot patrol routes from BLUE marker to RED marker.

  ROUTE CONNECTION:
  - Each route must START at the BLUE circle and END at the RED circle
  - Routes CONNECT these two points - they are PATHS, not area outlines
  - Do NOT draw any part of a route beyond the RED target marker
  - Do NOT draw any part before the BLUE start marker

  DRAWING RULES:
  - Draw smooth, curved lines that follow natural walking paths
  - NEVER cross through buildings - always go AROUND them
  - Follow roads, sidewalks, alleys, and open ground
  - Lines should curve naturally like a person walking, not straight angular segments
  - Use cover: stay close to walls, trees, and shadows where possible

  ORANGE LINE (Primary Route):
  - Most direct path while avoiding obstacles
  - Prefer main roads and open paths
  - Single continuous curved line from blue to red

  GREEN LINE (Stealth Route):
  - Longer, more concealed path
  - Use back alleys, building shadows, vegetation
  - Avoid open areas, stay near cover
  - Single continuous curved line from blue to red

  CRITICAL:
  - Routes must NEVER pass through any building or structure
  - Draw natural curved paths, not straight lines or sharp angles
  - Each route is ONE continuous line only - no branches, loops, or extensions past the markers
  
    
# Tactical Analysis Prompt (for advanced analytics)
analysis_prompt: |
  Analyze this tactical situation satellite image showing infantry approach routes.

  Context:
  - Friendly forces: {num_soldiers} units (at blue marker)
  - Enemy position: {num_enemies} units (at red marker)
  - Two routes shown: ORANGE (balanced), GREEN (stealth/safest)

  Provide tactical analysis in JSON format:
  {{
    "recommended_approach": {{
      "route": "green or orange",
      "reasoning": "Why this route is recommended"
    }},
    "timing_suggestions": {{
      "optimal_time": "dawn/dusk/night/day",
      "reasoning": "Why this timing"
    }},
    "equipment_recommendations": [
      {{"item": "Equipment", "reason": "Why needed"}}
    ],
    "risk_zones": [
      {{"location": "Description", "mitigation": "How to reduce risk"}}
    ],
    "enemy_analysis": {{
      "weakness": "Tactical weakness to exploit"
    }},
    "mission_summary": "2-3 sentence tactical summary"
  }}

# Route Evaluation Prompt (for user-drawn route analysis)
route_evaluation_prompt: |
  Analyze this satellite image showing a user-planned infantry patrol route.
  The BLUE DASHED LINE shows the proposed route from start to end.

  Unit Composition:
  - Squad size: {squad_size} soldiers
  - Riflemen: {riflemen}
  - Snipers: {snipers}
  - Support/MG: {support}
  - Medics: {medics}

  YOUR TASK: Evaluate the route and mark optimal tactical positions on the image.

  DRAW THESE MARKERS ON THE IMAGE:
  1. GREEN CIRCLES (size 15px) - Cover positions where soldiers can take shelter
  2. YELLOW TRIANGLES (size 20px) - Overwatch/sniper positions with good sightlines
  3. ORANGE SQUARES (size 15px) - Rally points for regrouping
  4. RED X MARKS (size 20px) - Danger zones that need caution (exposed areas, chokepoints)
  5. WHITE CROSS with red outline (size 18px) - Suggested medic station position

  IMPORTANT:
  - Keep the original BLUE route line clearly visible
  - Place markers NEAR the route, not on random locations
  - Consider building shadows, walls, and vegetation for cover
  - Snipers need elevated positions or long sightlines
  - Rally points should be concealed but accessible
  - Mark ALL exposed sections as danger zones

  Also return this JSON analysis (as text after the image):
  ```json
  {{
    "segments": [
      {{"index": 0, "risk": "low", "description": "Good cover along wall", "suggestions": ["Stay close to building"]}},
      {{"index": 1, "risk": "high", "description": "Open courtyard exposure", "suggestions": ["Move quickly", "Use smoke"]}}
    ],
    "positions": [
      {{"type": "overwatch", "description": "Rooftop corner with view of courtyard", "for_unit": "sniper"}},
      {{"type": "cover", "description": "Behind concrete barrier", "for_unit": "riflemen"}},
      {{"type": "rally", "description": "Alley between buildings", "for_unit": "all"}},
      {{"type": "danger", "description": "Wide open intersection", "for_unit": null}},
      {{"type": "medic", "description": "Protected alcove near route midpoint", "for_unit": "medic"}}
    ],
    "overall": "Brief 2-3 sentence assessment of the route quality and main concerns"
  }}
  ```

# Tactical Simulation Prompt (for Draw mode with enemy vision cones)
tactical_simulation_prompt: |
  Analyze this tactical scenario satellite image with the following elements:

  MARKED ON IMAGE:
  - BLUE DASHED LINE: Friendly unit movement route (numbered segments 0, 1, 2...)
  - BLUE SQUARE MARKERS: Friendly unit starting positions
  - RED CONE SHAPES: Enemy fields of view (vision cones)
    - Snipers: 500m range, 30° angle - MOST DANGEROUS, long range precision
    - Riflemen: 100m range, 60° angle - Close-medium range, wider field
    - Observers: 400m range, 45° angle - Will alert other enemies

  FRIENDLY FORCES: {num_friendlies} units
  {friendly_composition}

  ENEMY FORCES: {num_enemies} units
  {enemy_composition}

  CRITICAL ANALYSIS RULES:
  1. Buildings BLOCK enemy vision - routes BEHIND buildings are SAFE even if in cone angle
  2. Trees/vegetation provide PARTIAL cover (50% concealment)
  3. Only mark as EXPOSED if in cone AND no obstacles blocking line-of-sight
  4. Approaching from enemy's BACK (>90° from facing) = FLANKING BONUS

  YOUR TASK:
  1. For EACH route segment, analyze if it has COVER blocking enemy LOS
  2. Calculate FLANKING BONUS if approaching from enemy blind spot
  3. Score the tactical approach across multiple dimensions
  4. Provide a VERDICT rating the overall strategy
  5. Mark weak spots RED and strong points GREEN on the image

  Return analysis as JSON (MUST include all fields):
  ```json
  {{
    "verdict": "EXCELLENT",
    "strategy_rating": 8.5,
    "tactical_scores": {{
      "stealth": 85,
      "safety": 75,
      "terrain_usage": 90,
      "flanking": 95,
      "overall": 86
    }},
    "flanking_analysis": {{
      "is_flanking": true,
      "approach_angle": 135,
      "bonus_awarded": 2.5,
      "description": "Approaching from southeast, enemy facing north - excellent blind spot exploitation"
    }},
    "segment_cover_analysis": [
      {{
        "segment_index": 0,
        "in_vision_cone": false,
        "cover_status": "clear",
        "cover_type": null,
        "exposure_percentage": 0,
        "blocking_feature": null,
        "enemy_id": null,
        "explanation": "Segment outside all enemy vision cones"
      }},
      {{
        "segment_index": 1,
        "in_vision_cone": true,
        "cover_status": "covered",
        "cover_type": "building",
        "exposure_percentage": 0,
        "blocking_feature": "2-story concrete building",
        "enemy_id": "sniper_1",
        "explanation": "In sniper cone but building blocks line-of-sight completely"
      }},
      {{
        "segment_index": 2,
        "in_vision_cone": true,
        "cover_status": "exposed",
        "cover_type": "none",
        "exposure_percentage": 80,
        "blocking_feature": null,
        "enemy_id": "rifleman_1",
        "explanation": "Open ground crossing with no cover - DANGER"
      }}
    ],
    "cover_breakdown": {{
      "total_segments": 5,
      "exposed_count": 1,
      "covered_count": 3,
      "partial_count": 0,
      "clear_count": 1,
      "overall_cover_percentage": 80,
      "cover_types_used": ["building", "vegetation"]
    }},
    "weak_spots": [
      {{
        "location": "Segment 2",
        "description": "Open ground crossing in rifleman's field of fire",
        "severity": "high",
        "recommendation": "Deploy smoke or time movement when enemy looks away"
      }}
    ],
    "strong_points": [
      {{
        "location": "Segments 1, 3-4",
        "description": "Excellent use of building cover throughout approach",
        "benefit": "Completely hidden from sniper despite being in cone range"
      }}
    ],
    "terrain_assessment": "Route cleverly uses urban terrain with 80% of approach behind hard cover",
    "overall_assessment": "Excellent tactical approach exploiting enemy blind spots and urban cover. Only segment 2 requires caution.",
    "recommendations": [
      "Use smoke at segment 2 crossing",
      "Maintain current flanking approach angle",
      "Consider sniper overwatch from building corner before crossing"
    ]
  }}
  ```

  STRICT SCORING RULES (Be Critical - Default to LOWER scores):

  AUTOMATIC DEDUCTIONS (subtract from base score of 5):
  - ANY exposed segment in sniper cone: -2.0 points
  - ANY exposed segment in rifleman cone: -1.5 points
  - Route crosses open ground >30m: -1.0 points per crossing
  - No flanking angle (<60° from enemy facing): -1.5 points
  - Multiple enemies covering same segment: -1.0 points
  - Route is too direct/obvious: -1.0 points

  BONUSES (add to score):
  - True flanking (>120° from enemy): +1.5 points
  - Rear attack (>150° from enemy): +2.5 points
  - 90%+ segments have building cover: +1.0 points
  - Route uses terrain creatively: +0.5 points

  VERDICT THRESHOLDS (Strict):
  - EXCELLENT (8.5-10): 90%+ covered, rear flanking, zero exposed segments
  - GOOD (6.5-8.4): 75%+ covered, good flanking, max 1 exposed segment
  - ACCEPTABLE (4.5-6.4): 50-75% covered, some tactical thought
  - RISKY (0-4.4): <50% covered OR any critical exposure OR frontal approach

  IMPORTANT: Most routes should score 4-7. Only truly exceptional routes score 8+.
  A score of 7.5+ requires near-perfect cover AND flanking advantage.

# Marker Settings
markers:
  size: 6  # Smaller markers for cleaner route visualization
  start_color: [0, 100, 255]  # Blue
  end_color: [255, 50, 50]    # Red
  outline_color: [255, 255, 255]
  outline_width: 2

# API Settings
api:
  # Default timeout for external API calls (milliseconds)
  timeout_ms: 30000
  # CORS settings
  cors_allow_origins: ["*"]

# Geographic Restrictions
geo:
  # Gulf Cooperation Council countries bounding box
  gcc_bounds:
    north: 32.0
    south: 12.0
    east: 60.0
    west: 34.0
